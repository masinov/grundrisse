{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Argument Extraction Window",
  "description": "Complete extraction from a text window containing locutions, propositions, illocutions, relations, and transitions. Per AUTONOMOUS_DIALECTICAL_TREE_EXTRACTION.md Appendix A.",
  "type": "object",
  "required": ["locutions", "propositions", "illocutions", "relations"],
  "properties": {
    "locutions": {
      "type": "array",
      "description": "Spans of text extracted from the window. Per Appendix A: L-node immutable spans.",
      "items": {
        "type": "object",
        "required": ["loc_id", "text", "start_char", "end_char", "paragraph_id", "section_path"],
        "properties": {
          "loc_id": {
            "type": "string",
            "description": "Unique identifier for the locution (hash of doc_id + offsets)."
          },
          "text": {
            "type": "string",
            "description": "Verbatim text slice."
          },
          "start_char": {
            "type": "integer",
            "description": "Start offset in document."
          },
          "end_char": {
            "type": "integer",
            "description": "End offset in document."
          },
          "paragraph_id": {
            "type": "string",
            "description": "Paragraph identifier."
          },
          "section_path": {
            "type": "array",
            "items": {"type": "string"},
            "description": "DOM structural context (section hierarchy).",
            "default": []
          },
          "is_footnote": {
            "type": "boolean",
            "description": "True if from a footnote (polemical/definitional content).",
            "default": false
          },
          "footnote_links": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Linked loc_ids for cross-references.",
            "default": []
          }
        }
      }
    },
    "transitions": {
      "type": "array",
      "description": "Discourse transitions between locutions. Per Appendix A ยง3.3: Persisted first-class objects.",
      "items": {
        "type": "object",
        "required": ["transition_id", "doc_id", "from_loc_id", "to_loc_id", "marker", "function_hint", "position"],
        "properties": {
          "transition_id": {
            "type": "string",
            "description": "Unique transition identifier."
          },
          "doc_id": {
            "type": "string",
            "description": "Source document identifier (for cross-doc tracking)."
          },
          "from_loc_id": {
            "type": "string",
            "description": "Source locution (L-node)."
          },
          "to_loc_id": {
            "type": "string",
            "description": "Target locution (L-node)."
          },
          "marker": {
            "type": "string",
            "description": "Discourse marker (e.g., 'however', 'therefore')."
          },
          "function_hint": {
            "type": "string",
            "enum": ["contrast", "inference", "concession", "continuation"],
            "description": "Functional classification per Appendix A (exactly 4 types)."
          },
          "position": {
            "type": "integer",
            "description": "Sequential position in document."
          }
        }
      }
    },
    "propositions": {
      "type": "array",
      "description": "Abstract propositional content.",
      "items": {
        "type": "object",
        "required": ["prop_id", "surface_loc_ids", "text_summary"],
        "properties": {
          "prop_id": {
            "type": "string"
          },
          "surface_loc_ids": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "description": "Must reference at least one locution."
          },
          "text_summary": {
            "type": "string",
            "description": "Self-contained statement of content."
          },
          "concept_bindings": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "concept_label": {"type": "string"},
                "confidence": {"type": "number", "minimum": 0, "maximum": 1}
              }
            }
          },
          "entity_bindings": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "entity_id": {"type": "string"},
                "entity_type": {"type": "string", "enum": ["person", "school", "position", "unknown"]},
                "surface_form": {"type": "string"},
                "confidence": {"type": "number", "minimum": 0, "maximum": 1}
              }
            }
          },
          "temporal_scope": {
            "type": "string",
            "description": "e.g., '1844', 'Capitalist Mode'."
          },
          "is_implicit_reconstruction": {
            "type": "boolean",
            "description": "True if reconstructed from enthymeme.",
            "default": false
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 1.0
          }
        }
      }
    },
    "illocutions": {
      "type": "array",
      "description": "Illocutionary edges linking locutions to propositions.",
      "items": {
        "type": "object",
        "required": ["illoc_id", "source_loc_id", "target_prop_id", "force"],
        "properties": {
          "illoc_id": {
            "type": "string"
          },
          "source_loc_id": {
            "type": "string"
          },
          "target_prop_id": {
            "type": "string"
          },
          "force": {
            "type": "string",
            "enum": ["assert", "deny", "question", "define", "distinguish", "attribute", "concede", "ironic", "hypothetical", "prescriptive"],
            "description": "Illocutionary force."
          },
          "attributed_to": {
            "type": "string",
            "description": "Person/School being attributed (e.g., 'Ricardo')."
          },
          "is_implicit_opponent": {
            "type": "boolean",
            "description": "True if target is an unnamed opponent.",
            "default": false
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 1.0
          }
        }
      }
    },
    "relations": {
      "type": "array",
      "description": "Argumentative relations between propositions. Per Appendix A ยง3.6: RA/CA/MA nodes with mandatory evidence.",
      "items": {
        "type": "object",
        "required": ["rel_id", "relation_type", "source_prop_ids", "target_prop_id", "evidence_loc_ids"],
        "properties": {
          "rel_id": {
            "type": "string",
            "description": "Unique relation identifier."
          },
          "relation_type": {
            "type": "string",
            "enum": ["support", "conflict", "rephrase"],
            "description": "Type of argumentative relation per Appendix A."
          },
          "source_prop_ids": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "description": "Premises / Attacking Claims (one or more)."
          },
          "target_prop_id": {
            "type": "string",
            "description": "Conclusion / Attacked Claim (single)."
          },
          "conflict_detail": {
            "type": "string",
            "enum": ["rebut", "undercut", "incompatibility"],
            "description": "Type of conflict (required for conflict relations per Appendix A). Note: undercut per ยง7.3 targets the inference connection itself."
          },
          "evidence_loc_ids": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "description": "Text spans (e.g., 'therefore') licensing the link. MANDATORY per ยง12.1."
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 1.0,
            "description": "Classification confidence."
          }
        }
      }
    },
    "retrieved_propositions": {
      "type": "array",
      "description": "IDs of propositions retrieved from context (read-only).",
      "items": {"type": "string"},
      "default": []
    }
  }
}
